public class SetPinActivity extends AppCompatActivity {

    private StringBuilder pinBuilder = new StringBuilder();
    private boolean isPinVisible = false;
    private TextView[] pinDigits;
    private TextView toggleView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_set_pin);

        pinDigits = new TextView[] {
                findViewById(R.id.pin1),
                findViewById(R.id.pin2),
                findViewById(R.id.pin3),
                findViewById(R.id.pin4),
                findViewById(R.id.pin5),
                findViewById(R.id.pin6)
        };

        toggleView = findViewById(R.id.toggleView);
        toggleView.setOnClickListener(v -> {
            isPinVisible = !isPinVisible;
            toggleView.setText(isPinVisible ? "ðŸ™ˆ Hide PIN" : "ðŸ‘ View PIN");
            updatePinDisplay();
        });

        setupKeypad();
    }

    private void setupKeypad() {
        View.OnClickListener digitClick = v -> {
            if (pinBuilder.length() < 6) {
                Button b = (Button) v;
                pinBuilder.append(b.getText().toString());
                updatePinDisplay();
            }
        };

        for (int i = 0; i <= 9; i++) {
            int id = getResources().getIdentifier("btn" + i, "id", getPackageName());
            Button b = findViewById(id);
            if (b != null) b.setOnClickListener(digitClick);
        }

        findViewById(R.id.btnDelete).setOnClickListener(v -> {
            int len = pinBuilder.length();
            if (len > 0) {
                pinBuilder.deleteCharAt(len - 1);
                updatePinDisplay();
            }
        });

        findViewById(R.id.btnDone).setOnClickListener(v -> {
            if (pinBuilder.length() == 6) {
                Toast.makeText(this, "PIN Set: " + pinBuilder, Toast.LENGTH_SHORT).show();
            } else {
                Toast.makeText(this, "Enter 6-digit PIN", Toast.LENGTH_SHORT).show();
            }
        });
    }

    private void updatePinDisplay() {
        for (int i = 0; i < 6; i++) {
            if (i < pinBuilder.length()) {
                if (isPinVisible) {
                    pinDigits[i].setText(String.valueOf(pinBuilder.charAt(i)));
                    pinDigits[i].setBackground(null);
                } else {
                    pinDigits[i].setText("");
                    pinDigits[i].setBackground(ContextCompat.getDrawable(this, R.drawable.dot_active));
                }
            } else {
                pinDigits[i].setText("");
                pinDigits[i].setBackground(ContextCompat.getDrawable(this, R.drawable.dot_inactive));
            }
        }
    }
}
